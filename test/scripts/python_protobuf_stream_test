#!/usr/bin/env python3

import time

# Assuming there's a python ERS library available
from ers import OutputStream, StreamManager

class TestIssue:
    # This is a simplification; the real definition might be different
    def __init__(self, location, id, prev_issue=None):
        self.location = location
        self.id = id
        self.prev_issue = prev_issue

    def message(self):
        return f"this is issue with ID: {self.id}"

def main():
    conf = "protobufstream(monkafka.cern.ch:30092)"

    # Assuming there's a similar method for setting environment variables in the ERS Python library
    StreamManager.set_environment("DUNEDAQ_PARTITION", "TestPartition")
    StreamManager.set_environment("DUNEDAQ_APPLICATION_NAME", "ERSStreamTest")

    stream = StreamManager.create_out_stream(conf)

    n = 20
    for i in range(n):
        issue = TestIssue("ERS_HERE", i)
        stream.write(issue)
        time.sleep(0.5 + ((i % 2) * 1))  # Convert seconds to milliseconds

    first = TestIssue("ERS_HERE", 100)
    second = TestIssue("ERS_HERE", 200, first)
    third = TestIssue("ERS_HERE", 300, second)

    stream.write(third)
    time.sleep(0.5)

if __name__ == '__main__':
    main()

